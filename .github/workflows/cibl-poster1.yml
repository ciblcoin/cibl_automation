name: CIBL Telegram Poster
on:
  schedule:
    - cron: '0 */4 * * *'
  workflow_dispatch:
    inputs:
      post_number:
        description: 'Post number (1-10) or 0 for random'
        required: true
        default: '0'
        type: string
      post_type:
        description: 'Type of post'
        required: false
        default: 'random'
        type: choice
        options:
          - random
          - airdrop
          - announcement
          - price
          - community
          - short
          - regular

jobs:
  publish:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Install dependencies
        run: |
          pip install requests pillow

      - name: Create poster script
        run: |
          cat > poster.py << 'EOF'
          import os
          import sys
          import random
          import requests
          from datetime import datetime
          from io import BytesIO
          
          # Telegram config
          BOT_TOKEN = os.getenv('BOT_TOKEN')
          CHAT_ID = os.getenv('CHAT_ID')
          
          # Image URL from GitHub
          IMAGE_URL = "https://raw.githubusercontent.com/ciblcoin/app/main/public/videos/image1.png"
          
          # Button links
          BUTTONS = [
              {"text": "ğŸŒ WEBSITE", "url": "https://ciblcoin.com"},
              {"text": "ğŸª‚ AIRDROP", "url": "https://cbl.ag"},
              {"text": "ğŸ”„ SWAP TOKEN", "url": "https://phantom.com/tokens/solana/2Lpgt5teMe4SPp1G8x1URBk6dPRoimftdANmAsFDvkPA?referralId=2325rur2wft"}
          ]
          
          # Emoji collections
          EMOJIS = {
              "header": ["ğŸš€", "âœ¨", "âš¡", "ğŸŒŸ", "ğŸ’", "ğŸ”¥", "ğŸ¯", "ğŸ’«"],
              "social": ["ğŸ®", "ğ•", "ğŸ“±", "ğŸ’»", "ğŸ¦", "ğŸª", "ğŸ‘¾", "ğŸ•¹ï¸", "ğŸ“²", "ğŸ’¬"],
              "decorative": ["â¬‡ï¸", "â¬†ï¸", "â†—ï¸", "â†™ï¸", "â†˜ï¸", "â†”ï¸", "â†•ï¸", "ğŸ”„", "âš™ï¸", "ğŸ¨"]
          }
          
          # 10 Full-width English posts
          posts = [
              {
                  "type": "airdrop",
                  "title": "ğŸš€ CIBL MEGA AIRDROP - LIVE NOW! ğŸš€",
                  "content": """ğŸ”¥ The Biggest Airdrop Event on Solana Network!

ğŸ“ Contract Address:
<code>2Lpgt5teMe4SPp1G8x1URBk6dPRoimftdANmAsFDvkPA</code>

ğŸ¯ WHY CIBL TOKEN?
âœ… Massive Airdrop Rewards - Earn free tokens
âœ… Strong Community - 5,000+ holders & growing
âœ… Solana Network - Lightning fast, ultra low fees
âœ… Transparent Team - Fully doxxed & committed
âœ… Innovative Tokenomics - Sustainable growth model
âœ… Huge Potential - Early stage gem with massive upside

ğŸ”¥ LIMITED TIME OPPORTUNITY!
Early participants receive exclusive bonus rewards!

â° DON'T WAIT - JOIN THE REVOLUTION NOW!""",
                  "hashtags": "#CIBL #Solana #Airdrop #Crypto #DeFi #Memecoin"
              },
              
              {
                  "type": "price",
                  "title": "ğŸ“ˆ CIBL PRICE UPDATE â€“ TRENDING ON SOLANA! ğŸ“ˆ",
                  "content": """âš¡ Major Price Movement Detected â€“ Don't Miss Out!

ğŸ’° Current Price: Showing strong momentum
ğŸ“Š 24h Volume: Increasing rapidly

ğŸ“ Contract Address:
<code>2Lpgt5teMe4SPp1G8x1URBk6dPRoimftdANmAsFDvkPA</code>

ğŸš€ WHY CIBL IS MOVING?
ğŸ“Š Strong fundamentals and growing adoption
ğŸš€ Increasing trading volume and liquidity
ğŸ‘¥ Rapid community expansion
ğŸ¯ Strategic partnerships in development
ğŸ”¥ Positive market sentiment and momentum

ğŸ’ INVESTMENT OPPORTUNITY:
â€¢ Early stage project with massive potential
â€¢ Limited token supply available
â€¢ Growing ecosystem integration
â€¢ Upcoming exchange listings
â€¢ Marketing campaigns underway""",
                  "hashtags": "#CIBL #Solana #Crypto #Trading #Investing #Web3"
              },
              
              {
                  "type": "community",
                  "title": "ğŸ‘¥ JOIN 5,000+ CIBL HOLDERS COMMUNITY! ğŸ‘¥",
                  "content": """ğŸ’ª Strongest & Fastest Growing Community on Solana!

ğŸ“ CONTRACT ADDRESS:
<code>2Lpgt5teMe4SPp1G8x1URBk6dPRoimftdANmAsFDvkPA</code>

ğŸ¤ COMMUNITY BENEFITS:
âœ… Active discussions 24/7
âœ… Regular AMA sessions with team
âœ… Exclusive community events
âœ… Early access to announcements
âœ… Voting rights on decisions
âœ… Supportive environment

ğŸŒŸ WHY OUR COMMUNITY STANDS OUT:
âœ¨ Genuine engagement and real conversations
âœ¨ Helpful members always ready to assist
âœ¨ Educational content for all levels
âœ¨ Positive and encouraging atmosphere
âœ¨ Strong sense of unity and common goals

ğŸš€ JOIN THE MOVEMENT TODAY!""",
                  "hashtags": "#CIBL #Solana #Community #Crypto #Blockchain"
              },
              
              {
                  "type": "announcement",
                  "title": "ğŸ“¢ IMPORTANT CIBL ANNOUNCEMENT ğŸ“¢",
                  "content": """ğŸŒŸ Major Update for All CIBL Community Members!

ğŸ“ CONTRACT ADDRESS:
<code>2Lpgt5teMe4SPp1G8x1URBk6dPRoimftdANmAsFDvkPA</code>

ğŸ¯ ANNOUNCEMENT DETAILS:
âœ… New strategic partnerships secured
âœ… Roadmap updates and future developments
âœ… Enhanced token utility and features
âœ… Expanded team with industry experts
âœ… Improved website and documentation
âœ… Upcoming marketing initiatives

ğŸš€ WHAT THIS MEANS FOR YOU:
âœ¨ Increased token value and utility
âœ¨ Greater exposure and recognition
âœ¨ More opportunities for rewards
âœ¨ Enhanced platform features
âœ¨ Stronger market position
âœ¨ Better user experience

â° STAY TUNED FOR MORE UPDATES!""",
                  "hashtags": "#CIBL #Solana #Announcement #Update #DeFi"
              },
              
              {
                  "type": "regular",
                  "title": "âœ¨ FROM STRUGGLE TO SUCCESS âœ¨",
                  "content": """Our friends made an incredible journey - now it's your turn!

ğŸ™ï¸ Their city is full of animal friends, but cats are always first in line!

ğŸ’ Time to fall in love with TON. Stay tuned, engage, and get rewarded!

ğŸ¯ Quick Action Buttons Below â¬‡ï¸""",
                  "hashtags": "#Transformation #Crypto #TON #Success #CIBL"
              },
              
              {
                  "type": "short",
                  "title": "ğŸš€ CIBL IS TRENDING! ğŸš€",
                  "content": """Massive movements detected
Join the revolution now!

âš¡ Quick Actions Below â¬‡ï¸""",
                  "hashtags": "#CIBL #Solana #Crypto #Trending"
              },
              
              {
                  "type": "airdrop",
                  "title": "âš¡ URGENT: LIMITED TIME OFFER! âš¡",
                  "content": """CIBL Airdrop closing soon!
Last chance to claim bonus rewards!

ğŸ“ Contract Address:
<code>2Lpgt5teMe4SPp1G8x1URBk6dPRoimftdANmAsFDvkPA</code>

ğŸ¯ DON'T MISS OUT:
âœ… Exclusive bonus for early participants
âœ… Limited token distribution
âœ… Growing community benefits
âœ… Potential for massive returns

â° ACT BEFORE IT'S TOO LATE!""",
                  "hashtags": "#CIBL #Airdrop #Urgent #LimitedTime #Crypto"
              },
              
              {
                  "type": "announcement",
                  "title": "ğŸŒ CIBL ECOSYSTEM EXPANSION ğŸŒ",
                  "content": """Growing beyond expectations!
New integrations and partnerships live.

ğŸ“ CONTRACT ADDRESS:
<code>2Lpgt5teMe4SPp1G8x1URBk6dPRoimftdANmAsFDvkPA</code>

ğŸŒŸ NEW ADDITIONS:
âœ… Enhanced swap functionality
âœ… Additional wallet integrations
âœ… Expanded token utilities
âœ… New partnership announcements
âœ… Community feature upgrades
âœ… Marketing campaign expansion

ğŸš€ BE PART OF OUR GROWTH STORY!""",
                  "hashtags": "#CIBL #Ecosystem #Growth #Solana #Web3"
              },
              
              {
                  "type": "community",
                  "title": "ğŸŒ CONNECT WITH CIBL ACROSS ALL PLATFORMS! ğŸŒ",
                  "content": """âœ¨ Join Our Growing Social Media Network! âœ¨

ğŸ“ Contract Address:
<code>2Lpgt5teMe4SPp1G8x1URBk6dPRoimftdANmAsFDvkPA</code>

ğŸ“± FOLLOW US EVERYWHERE:
ğŸ¦ Twitter (X): Latest announcements
ğŸ’¬ Telegram: 24/7 community discussions
ğŸ“¸ Instagram: Visual content & highlights
ğŸ® Discord: Advanced discussions
ğŸ“º YouTube: Tutorials & educational content

ğŸ”— STAY UPDATED WITH EVERY DEVELOPMENT!""",
                  "hashtags": "#CIBL #Solana #SocialMedia #Community #Network"
              },
              
              {
                  "type": "airdrop",
                  "title": "â° FINAL 24 HOURS! â°",
                  "content": """CIBL Mega Airdrop closing soon!
Last opportunity for bonus rewards!

ğŸ”¥ WHAT YOU GET:
âœ… Free CIBL tokens
âœ… Exclusive bonus rewards
âœ… Early adopter benefits
âœ… Community membership
âœ… Future airdrop eligibility
âœ… Voting rights

ğŸ¯ CONTRACT ADDRESS:
<code>2Lpgt5teMe4SPp1G8x1URBk6dPRoimftdANmAsFDvkPA</code>

ğŸ’ DON'T REGRET MISSING OUT!""",
                  "hashtags": "#CIBL #FinalHours #Airdrop #LastChance #Crypto"
              }
          ]
          
          def select_post(post_num_str, post_type):
              """Select a post based on input"""
              try:
                  # If specific number requested
                  if post_num_str.isdigit():
                      num = int(post_num_str)
                      if 1 <= num <= len(posts):
                          return posts[num - 1]
                  
                  # Filter by type if specified
                  if post_type != 'random':
                      filtered = [p for p in posts if p['type'] == post_type]
                      if filtered:
                          return random.choice(filtered)
                  
                  # Default: random post
                  return random.choice(posts)
              except:
                  return random.choice(posts)
          
          def create_glass_buttons():
              """Create full-width glass effect buttons"""
              button_texts = []
              for btn in BUTTONS:
                  button_texts.append(f'<a href="{btn["url"]}">{btn["text"]}</a>')
              
              # Create full-width buttons with glass effect (using HTML formatting)
              buttons_html = f"""
    <b>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</b>
    {button_texts[0]}
    <b>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</b>
    {button_texts[1]}
    <b>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</b>
    {button_texts[2]}
    <b>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</b>
    """
              return buttons_html
          
          def format_full_width_message(post_data):
              """Format full-width message with image, content, and buttons"""
              # Random social icons
              social_icons = random.sample(EMOJIS["social"], 4)
              social_line = " | ".join(social_icons)
              
              # Create message
              message = f"""<b>{post_data['title']}</b>

    {post_data['content']}

    <b>ğŸ”¥ QUICK ACTIONS ğŸ”¥</b>
    {create_glass_buttons()}

    <b>{social_line}</b>

    <b>{post_data['hashtags']}</b>

    â° Posted: {datetime.now().strftime("%Y-%m-%d %H:%M UTC")}
    """
              return message
          
          def send_photo_with_caption(image_url, caption):
              """Send photo with caption to Telegram"""
              url = f"https://api.telegram.org/bot{BOT_TOKEN}/sendPhoto"
              
              payload = {
                  "chat_id": CHAT_ID,
                  "photo": image_url,
                  "caption": caption,
                  "parse_mode": "HTML",
                  "disable_web_page_preview": False
              }
              
              try:
                  response = requests.post(url, json=payload, timeout=30)
                  response.raise_for_status()
                  return response.json()
              except Exception as e:
                  print(f"Error sending photo: {e}")
                  # Fallback to text-only
                  return send_text_message(caption)
          
          def send_text_message(text):
              """Send text-only message (fallback)"""
              url = f"https://api.telegram.org/bot{BOT_TOKEN}/sendMessage"
              payload = {
                  "chat_id": CHAT_ID,
                  "text": text,
                  "parse_mode": "HTML",
                  "disable_web_page_preview": False
              }
              
              try:
                  response = requests.post(url, json=payload, timeout=30)
                  response.raise_for_status()
                  return response.json()
              except Exception as e:
                  print(f"Error sending text: {e}")
                  return None
          
          def main():
              print("ğŸš€ Starting CIBL Telegram Poster with Image")
              
              # Check credentials
              if not BOT_TOKEN or not CHAT_ID:
                  print("âŒ Missing Telegram credentials")
                  sys.exit(1)
              
              # Get inputs
              post_num = os.getenv('POST_NUMBER', '0')
              post_type = os.getenv('POST_TYPE', 'random')
              
              print(f"ğŸ“Š Post number: {post_num}")
              print(f"ğŸ“ Post type: {post_type}")
              print(f"ğŸ“¢ Channel ID: {CHAT_ID}")
              print(f"ğŸ–¼ï¸ Image URL: {IMAGE_URL}")
              
              # Select post
              post_data = select_post(post_num, post_type)
              print(f"ğŸ¯ Selected post type: {post_data['type']}")
              
              # Format message
              caption = format_full_width_message(post_data)
              
              # Show preview
              print("\nğŸ“‹ Post preview (first 300 chars):")
              print("-" * 60)
              preview = caption.replace("<b>", "").replace("</b>", "").replace("<code>", "").replace("</code>", "")
              print(preview[:300] + "...")
              print("-" * 60)
              
              # Send to Telegram with image
              print("\nğŸ“¤ Sending to Telegram with image...")
              result = send_photo_with_caption(IMAGE_URL, caption)
              
              if result and result.get('ok'):
                  msg_id = result['result']['message_id']
                  print(f"âœ… Success! Message ID: {msg_id}")
                  print(f"ğŸ‰ Post published to @CiBLofficial")
                  print(f"ğŸ–¼ï¸ Image: {IMAGE_URL}")
                  return True
              else:
                  print("âŒ Failed to send message")
                  if result:
                      print(f"Error details: {result}")
                  return False
          
          if __name__ == "__main__":
              success = main()
              sys.exit(0 if success else 1)
          EOF
          
          echo "âœ… Poster script with image created"

      - name: Run poster
        env:
          BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          CHAT_ID: ${{ secrets.TELEGRAM_CHANNEL_ID }}
          POST_NUMBER: ${{ github.event.inputs.post_number }}
          POST_TYPE: ${{ github.event.inputs.post_type }}
        run: |
          python poster.py

      - name: Show result
        run: |
          echo "âœ… CIBL post published successfully!"
          echo "ğŸ•’ Time: $(date)"
          echo "ğŸ“¢ Channel: @CiBLofficial"
          echo "ğŸ¤– Bot: @CIBtokenBot"