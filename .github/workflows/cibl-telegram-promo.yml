name: CIBL Telegram Promoter

on:
  workflow_dispatch:
    inputs:
      message_type:
        description: 'Ù†ÙˆØ¹ Ù¾ÛŒØ§Ù… ØªØ¨Ù„ÛŒØºØ§ØªÛŒ'
        required: true
        default: 'airdrop'
        type: choice
        options:
          - airdrop
          - announcement
          - community
          - urgent
      include_stats:
        description: 'Ù†Ù…Ø§ÛŒØ´ Ø¢Ù…Ø§Ø± Ù„Ø­Ø¸Ù‡â€ŒØ§ÛŒ Ù‚ÛŒÙ…ØªØŸ'
        required: true
        default: 'true'
        type: boolean
      custom_text:
        description: 'Ù…ØªÙ† Ø§Ø¶Ø§ÙÛŒ Ø¯Ù„Ø®ÙˆØ§Ù‡ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)'
        required: false
        default: ''

env:
  TELEGRAM_CHANNEL: "@CIBLOfficial"
  CIBL_GIF: "https://raw.githubusercontent.com/ciblcoin/app/main/public/videos/logo.gif"
  CONTRACT: "2Lpgt5teMe4SPp1G8x1URBk6dPRoimftdANmAsFDvkPA"

jobs:
  promote-cibl:
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ Ø´Ø±ÙˆØ¹ Ø¹Ù…Ù„ÛŒØ§Øª
        run: |
          echo "=== CIBL TELEGRAM PROMOTION ==="
          echo "ğŸ“… Ø²Ù…Ø§Ù†: $(date)"
          echo "ğŸ“¢ Ú©Ø§Ù†Ø§Ù„: ${{ env.TELEGRAM_CHANNEL }}"
          echo "ğŸ¯ Ù†ÙˆØ¹: ${{ github.event.inputs.message_type }}"
          echo "ğŸ“Š Ø¢Ù…Ø§Ø±: ${{ github.event.inputs.include_stats }}"

      - name: ğŸ“Š Ø¯Ø±ÛŒØ§ÙØª Ø¢Ù…Ø§Ø± Ù„Ø­Ø¸Ù‡â€ŒØ§ÛŒ
        if: ${{ github.event.inputs.include_stats == 'true' }}
        id: stats
        run: |
          echo "Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§Ø² DexScreener..."
          
          # Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² API Ø³Ø§Ø¯Ù‡
          response=$(curl -s "https://api.dexscreener.com/latest/dex/tokens/${{ env.CONTRACT }}")
          
          # Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
          price=$(echo $response | jq -r '.pairs[0].priceUsd // "0"')
          change=$(echo $response | jq -r '.pairs[0].priceChange.h24 // "0"')
          
          if [ "$price" != "0" ]; then
            # ÙØ±Ù…Øª Ù‚ÛŒÙ…Øª
            formatted_price=$(echo "scale=8; $price" | bc | sed 's/0*$//' | sed 's/\.$//')
            if [[ ! $formatted_price == *"."* ]]; then
              formatted_price="$formatted_price.0"
            fi
            
            # Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø§Ø² ÙˆØ¬ÙˆØ¯ Ø¹Ù„Ø§Ù…Øª Ø¯Ù„Ø§Ø±
            if [[ ! $formatted_price == "$"* ]]; then
              formatted_price="\$$formatted_price"
            fi
            
            # ÙØ±Ù…Øª ØªØºÛŒÛŒØ±Ø§Øª
            if (( $(echo "$change >= 0" | bc -l) )); then
              formatted_change="ğŸŸ¢ +$change%"
            else
              formatted_change="ğŸ”´ $change%"
            fi
          else
            formatted_price="\$$(echo 'scale=6; 0.000001' | bc)"
            formatted_change="ğŸŸ¢ +0.00%"
          fi
          
          echo "price=$formatted_price" >> $GITHUB_OUTPUT
          echo "change=$formatted_change" >> $GITHUB_OUTPUT
          echo "chart_url=https://dexscreener.com/solana/${{ env.CONTRACT }}" >> $GITHUB_OUTPUT
          
          echo "âœ… Ø¢Ù…Ø§Ø± Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯:"
          echo "ğŸ’° $formatted_price"
          echo "ğŸ“ˆ $formatted_change"

      - name: âœï¸ ØªÙˆÙ„ÛŒØ¯ Ù…ØªÙ† Ù¾Ø³Øª
        id: content
        run: |
          # Ø§Ù†ØªØ®Ø§Ø¨ Ø¹Ù†ÙˆØ§Ù†
          case "${{ github.event.inputs.message_type }}" in
            "airdrop")
              TITLE="ğŸš€ CIBL MEGA AIRDROP - LIVE NOW!"
              SUBTITLE="Join the biggest airdrop event on Solana!"
              ;;
            "urgent")
              TITLE="ğŸ”¥ URGENT: CIBL PRICE SURGE IMMINENT!"
              SUBTITLE="Major movement detected - Act fast!"
              ;;
            "community")
              TITLE="ğŸ‘¥ JOIN 5K+ CIBL HOLDERS COMMUNITY"
              SUBTITLE="Strongest community on Solana!"
              ;;
            *)
              TITLE="ğŸŒŸ CIBL ($CIB) - SOLANA GEM"
              SUBTITLE="Next big token on Solana ecosystem!"
              ;;
          esac
          
          # Ø¨Ø®Ø´ Ø¢Ù…Ø§Ø±
          STATS=""
          if [ "${{ github.event.inputs.include_stats }}" = "true" ]; then
            STATS="<b>ğŸ“ˆ LIVE PRICE:</b> ${{ steps.stats.outputs.price }}
<b>ğŸ“Š 24H CHANGE:</b> ${{ steps.stats.outputs.change }}

"
          fi
          
          # Ù…ØªÙ† Ø³ÙØ§Ø±Ø´ÛŒ
          CUSTOM=""
          if [ -n "${{ github.event.inputs.custom_text }}" ]; then
            CUSTOM="\n\n<b>ğŸ“¢ SPECIAL MESSAGE:</b>\n${{ github.event.inputs.custom_text }}\n"
          fi
          
          # Ø³Ø§Ø®Øª Ù…ØªÙ† Ù†Ù‡Ø§ÛŒÛŒ
          POST="<b>$TITLE</b>

$SUBTITLE

<b>ğŸ“ CONTRACT ADDRESS:</b>
<code>${{ env.CONTRACT }}</code>

$STATS<b>âœ… WHY CIBL?</b>
ğŸ <b>Massive Airdrop</b> - Earn free tokens
ğŸ‘¥ <b>Strong Community</b> - 5,000+ holders
âš¡ <b>Solana Speed</b> - Instant transactions
ğŸ”’ <b>Transparent Team</b> - Fully doxxed
ğŸ“ˆ <b>Huge Potential</b> - Early stage gem

<b>ğŸ”¥ LIMITED TIME OPPORTUNITY!</b>
Early participants get bonus rewards!$CUSTOM

<b>â° DON'T MISS OUT - JOIN NOW!</b>

#CIBL #Solana #Airdrop #Crypto #DeFi #Memecoin #Web3"
          
          echo "post_content<<EOF" >> $GITHUB_OUTPUT
          echo "$POST" >> $GITHUB_OUTPUT
          echo "EOF" >> $GITHUB_OUTPUT
          
          echo "âœ… Ù…ØªÙ† Ù¾Ø³Øª Ø¢Ù…Ø§Ø¯Ù‡ Ø´Ø¯"

      - name: ğŸ“¤ Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ ØªÙ„Ú¯Ø±Ø§Ù…
        env:
          BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
        run: |
          echo "Ø§Ø±Ø³Ø§Ù„ Ù¾Ø³Øª Ø¨Ù‡ Ú©Ø§Ù†Ø§Ù„ ØªÙ„Ú¯Ø±Ø§Ù…..."
          
          # Ø³Ø§Ø®Øª Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø´ÛŒØ´Ù‡â€ŒØ§ÛŒ Ø²ÛŒØ¨Ø§
          BUTTONS='{
            "inline_keyboard": [
              [
                {"text": "ğŸŒ Official Website", "url": "https://ciblcoin.com"},
                {"text": "ğŸ Join Airdrop", "url": "https://cbl.ag"}
              ],
              [
                {"text": "ğŸ“Š View Live Chart", "url": "${{ steps.stats.outputs.chart_url }}"},
                {"text": "ğŸ¦ Follow on Twitter", "url": "https://twitter.com/ciblcoin"}
              ]
            ]
          }'
          
          # Ø§Ø±Ø³Ø§Ù„ Ù¾Ø³Øª
          RESPONSE=$(curl -s -X POST \
            -H "Content-Type: application/json" \
            -d "{
              \"chat_id\": \"${{ env.TELEGRAM_CHANNEL }}\",
              \"animation\": \"${{ env.CIBL_GIF }}\",
              \"caption\": \"${{ steps.content.outputs.post_content }}\",
              \"parse_mode\": \"HTML\",
              \"reply_markup\": $BUTTONS
            }" \
            "https://api.telegram.org/bot$BOT_TOKEN/sendAnimation")
          
          # Ø¨Ø±Ø±Ø³ÛŒ Ù†ØªÛŒØ¬Ù‡
          if echo "$RESPONSE" | grep -q '"ok":true'; then
            MSG_ID=$(echo "$RESPONSE" | grep -o '"message_id":[0-9]*' | head -1 | cut -d: -f2)
            echo "ğŸ‰ Ù¾Ø³Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯!"
            echo "ğŸ“± Message ID: $MSG_ID"
            echo "ğŸ”— View at: https://t.me/CIBLOfficial"
            
            # Ø§Ø±Ø³Ø§Ù„ ØªØ£ÛŒÛŒØ¯ÛŒÙ‡ Ø¨Ù‡ Ø§Ø¯Ù…ÛŒÙ†
            curl -s -X POST \
              -H "Content-Type: application/json" \
              -d "{
                \"chat_id\": \"${{ secrets.ADMIN_CHAT_ID }}\",
                \"text\": \"âœ… <b>CIBL Post Published!</b>\n\nğŸ“¢ Channel: @CIBLOfficial\nğŸ¯ Type: ${{ github.event.inputs.message_type }}\nğŸ†” Message ID: $MSG_ID\nâ° Time: $(date '+%H:%M:%S')\n\nâœ… Post sent successfully!\",
                \"parse_mode\": \"HTML\",
                \"disable_web_page_preview\": true
              }" \
              "https://api.telegram.org/bot$BOT_TOKEN/sendMessage" || true
              
          else
            echo "âŒ Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ù¾Ø³Øª!"
            echo "Error response: $RESPONSE"
            
            # Ø§Ø±Ø³Ø§Ù„ Ø®Ø·Ø§ Ø¨Ù‡ Ø§Ø¯Ù…ÛŒÙ†
            ERROR_MSG=$(echo "$RESPONSE" | grep -o '"description":"[^"]*"' | cut -d'"' -f4 || echo "Unknown error")
            
            curl -s -X POST \
              -H "Content-Type: application/json" \
              -d "{
                \"chat_id\": \"${{ secrets.ADMIN_CHAT_ID }}\",
                \"text\": \"âŒ <b>FAILED to send CIBL post!</b>\n\nğŸš¨ Error: $ERROR_MSG\nğŸ“¢ Channel: @CIBLOfficial\nâ° Time: $(date)\",
                \"parse_mode\": \"HTML\"
              }" \
              "https://api.telegram.org/bot$BOT_TOKEN/sendMessage" || true
              
            exit 1
          fi

      - name: âœ… ØªÚ©Ù…ÛŒÙ„
        run: |
          echo "================================="
          echo "âœ… WORKFLOW COMPLETED SUCCESSFULLY"
          echo "ğŸ“¢ Post published to @CIBLOfficial"
          echo "â° Finished at: $(date)"
          echo "================================="