name: CIBL Telegram Poster
on:
  workflow_dispatch:
    inputs:
      post_number:
        description: 'Post number (1-10) or 0 for random'
        required: true
        default: '0'
        type: string

jobs:
  publish:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Install dependencies
        run: |
          pip install requests

      - name: Create poster script
        run: |
          cat > poster.py << 'EOF'
          import os
          import sys
          import random
          import requests
          from datetime import datetime
          
          # Configuration
          BOT_TOKEN = os.getenv('BOT_TOKEN')
          CHAT_ID = os.getenv('CHAT_ID')
          
          # Image URL
          IMAGE_URL = "https://raw.githubusercontent.com/ciblcoin/app/main/public/videos/image1.png"
          
          # Posts Database - 10 English posts with FULL WIDTH formatting
          posts = [
              '''<b>ğŸš€ CIBL MEGA AIRDROP - LIVE NOW! ğŸš€</b>

ğŸ”¥ <b>The Biggest Airdrop Event on Solana Network!</b>

ğŸ“ <b>Contract Address:</b>
<code>2Lpgt5teMe4SPp1G8x1URBk6dPRoimftdANmAsFDvkPA</code>

ğŸ¯ <b>WHY CIBL TOKEN?</b>
âœ… Massive Airdrop Rewards - Earn free tokens
âœ… Strong Community - 5,000+ holders & growing
âœ… Solana Network - Lightning fast, ultra low fees
âœ… Transparent Team - Fully doxxed & committed
âœ… Innovative Tokenomics - Sustainable growth model
âœ… Huge Potential - Early stage gem with massive upside

ğŸ”¥ <b>LIMITED TIME OPPORTUNITY!</b>
Early participants receive exclusive bonus rewards!

â° <b>DON'T WAIT - JOIN THE REVOLUTION NOW!</b>''',
              
              '''<b>ğŸ“ˆ CIBL PRICE UPDATE â€“ TRENDING ON SOLANA! ğŸ“ˆ</b>

âš¡ <b>Major Price Movement Detected â€“ Don't Miss Out!</b>

ğŸ“ <b>Contract Address:</b>
<code>2Lpgt5teMe4SPp1G8x1URBk6dPRoimftdANmAsFDvkPA</code>

ğŸš€ <b>WHY CIBL IS MOVING?</b>
ğŸ“Š Strong fundamentals and growing adoption
ğŸš€ Increasing trading volume and liquidity
ğŸ‘¥ Rapid community expansion
ğŸ¯ Strategic partnerships in development
ğŸ”¥ Positive market sentiment and momentum

ğŸ’ <b>INVESTMENT OPPORTUNITY:</b>
â€¢ Early stage project with massive potential
â€¢ Limited token supply available
â€¢ Growing ecosystem integration
â€¢ Upcoming exchange listings
â€¢ Marketing campaigns underway''',
              
              '''<b>ğŸ‘¥ JOIN 5,000+ CIBL HOLDERS COMMUNITY! ğŸ‘¥</b>

ğŸ’ª <b>Strongest & Fastest Growing Community on Solana!</b>

ğŸ“ <b>CONTRACT ADDRESS:</b>
<code>2Lpgt5teMe4SPp1G8x1URBk6dPRoimftdANmAsFDvkPA</code>

ğŸ¤ <b>COMMUNITY BENEFITS:</b>
âœ… Active discussions 24/7
âœ… Regular AMA sessions with team
âœ… Exclusive community events
âœ… Early access to announcements
âœ… Voting rights on decisions
âœ… Supportive environment

ğŸŒŸ <b>WHY OUR COMMUNITY STANDS OUT:</b>
âœ¨ Genuine engagement and real conversations
âœ¨ Helpful members always ready to assist
âœ¨ Educational content for all levels
âœ¨ Positive and encouraging atmosphere
âœ¨ Strong sense of unity and common goals

ğŸš€ <b>JOIN THE MOVEMENT TODAY!</b>''',
              
              '''<b>ğŸ“¢ IMPORTANT CIBL ANNOUNCEMENT ğŸ“¢</b>

ğŸŒŸ <b>Major Update for All CIBL Community Members!</b>

ğŸ“ <b>CONTRACT ADDRESS:</b>
<code>2Lpgt5teMe4SPp1G8x1URBk6dPRoimftdANmAsFDvkPA</code>

ğŸ¯ <b>ANNOUNCEMENT DETAILS:</b>
âœ… New strategic partnerships secured
âœ… Roadmap updates and future developments
âœ… Enhanced token utility and features
âœ… Expanded team with industry experts
âœ… Improved website and documentation
âœ… Upcoming marketing initiatives

ğŸš€ <b>WHAT THIS MEANS FOR YOU:</b>
âœ¨ Increased token value and utility
âœ¨ Greater exposure and recognition
âœ¨ More opportunities for rewards
âœ¨ Enhanced platform features
âœ¨ Stronger market position
âœ¨ Better user experience

â° <b>STAY TUNED FOR MORE UPDATES!</b>''',
              
              '''<b>âœ¨ FROM STRUGGLE TO SUCCESS âœ¨</b>

Our friends made an incredible journey - now it's your turn!

ğŸ™ï¸ Their city is full of animal friends, but cats are always first in line!

ğŸ’ Time to fall in love with TON. Stay tuned, engage, and get rewarded!

ğŸ¯ <b>Quick Action Buttons Below â¬‡ï¸</b>''',
              
              '''<b>ğŸš€ CIBL IS TRENDING! ğŸš€</b>

Massive movements detected
Join the revolution now!

âš¡ <b>Quick Actions Below â¬‡ï¸</b>''',
              
              '''<b>âš¡ URGENT: LIMITED TIME OFFER! âš¡</b>

CIBL Airdrop closing soon!
Last chance to claim bonus rewards!

ğŸ“ <b>Contract Address:</b>
<code>2Lpgt5teMe4SPp1G8x1URBk6dPRoimftdANmAsFDvkPA</code>

ğŸ¯ <b>DON'T MISS OUT:</b>
âœ… Exclusive bonus for early participants
âœ… Limited token distribution
âœ… Growing community benefits
âœ… Potential for massive returns

â° <b>ACT BEFORE IT'S TOO LATE!</b>''',
              
              '''<b>ğŸŒ CIBL ECOSYSTEM EXPANSION ğŸŒ</b>

Growing beyond expectations!
New integrations and partnerships live.

ğŸ“ <b>CONTRACT ADDRESS:</b>
<code>2Lpgt5teMe4SPp1G8x1URBk6dPRoimftdANmAsFDvkPA</code>

ğŸŒŸ <b>NEW ADDITIONS:</b>
âœ… Enhanced swap functionality
âœ… Additional wallet integrations
âœ… Expanded token utilities
âœ… New partnership announcements
âœ… Community feature upgrades
âœ… Marketing campaign expansion

ğŸš€ <b>BE PART OF OUR GROWTH STORY!</b>''',
              
              '''<b>ğŸŒ CONNECT WITH CIBL ACROSS ALL PLATFORMS! ğŸŒ</b>

âœ¨ <b>Join Our Growing Social Media Network! âœ¨</b>

ğŸ“ <b>Contract Address:</b>
<code>2Lpgt5teMe4SPp1G8x1URBk6dPRoimftdANmAsFDvkPA</code>

ğŸ“± <b>FOLLOW US EVERYWHERE:</b>
ğŸ¦ Twitter (X): Latest announcements
ğŸ’¬ Telegram: 24/7 community discussions
ğŸ“¸ Instagram: Visual content & highlights
ğŸ® Discord: Advanced discussions
ğŸ“º YouTube: Tutorials & educational content

ğŸ”— <b>STAY UPDATED WITH EVERY DEVELOPMENT!</b>''',
              
              '''<b>â° FINAL 24 HOURS! â°</b>

CIBL Mega Airdrop closing soon!
Last opportunity for bonus rewards!

ğŸ”¥ <b>WHAT YOU GET:</b>
âœ… Free CIBL tokens
âœ… Exclusive bonus rewards
âœ… Early adopter benefits
âœ… Community membership
âœ… Future airdrop eligibility
âœ… Voting rights

ğŸ“ <b>Contract Address:</b>
<code>2Lpgt5teMe4SPp1G8x1URBk6dPRoimftdANmAsFDvkPA</code>

ğŸ’ <b>DON'T REGRET MISSING OUT!</b>'''
          ]
          
          # Hashtags
          hashtags = [
              "#CIBL #Solana #Airdrop #Crypto #DeFi #Memecoin",
              "#CIBL #Solana #Crypto #Trading #Investing #Web3",
              "#CIBL #Solana #Community #Crypto #Blockchain",
              "#CIBL #Solana #Announcement #Update #DeFi",
              "#Transformation #Crypto #TON #Success #CIBL",
              "#CIBL #Solana #Crypto #Trending",
              "#CIBL #Airdrop #Urgent #LimitedTime #Crypto",
              "#CIBL #Ecosystem #Growth #Solana #Web3",
              "#CIBL #Solana #SocialMedia #Community #Network",
              "#CIBL #FinalHours #Airdrop #LastChance #Crypto"
          ]
          
          # Social icons
          social_sets = [
              ["ğŸ®", "ğ•", "ğŸ“±", "ğŸ’»"],
              ["ğŸ¦", "ğŸª", "ğŸ‘¾", "ğŸ•¹ï¸"],
              ["ğŸ“²", "ğŸ’¬", "ğŸ“º", "ğŸ¯"],
              ["âœ¨", "âš¡", "ğŸŒŸ", "ğŸ’"]
          ]
          
          def select_post(post_num):
              try:
                  if post_num.isdigit():
                      num = int(post_num)
                      if 1 <= num <= len(posts):
                          return posts[num - 1], hashtags[num - 1]
                  return random.choice(posts), random.choice(hashtags)
              except:
                  return random.choice(posts), random.choice(hashtags)
          
          def create_buttons():
              """Create inline buttons for FULL WIDTH display"""
              return {
                  "inline_keyboard": [
                      # Each button on its own line for full width
                      [{"text": "ğŸŒ WEBSITE - ciblcoin.com", "url": "https://ciblcoin.com"}],
                      [{"text": "ğŸª‚ AIRDROP - cbl.ag", "url": "https://cbl.ag"}],
                      [{"text": "ğŸ”„ SWAP TOKEN - Phantom", "url": "https://phantom.com/tokens/solana/2Lpgt5teMe4SPp1G8x1URBk6dPRoimftdANmAsFDvkPA?referralId=2325rur2wft"}]
                  ]
              }
          
          def create_caption(post_text, post_hashtags):
              """Create caption with FULL WIDTH formatting"""
              # Select random social icons
              social_icons = random.choice(social_sets)
              
              # Create FULL WIDTH separators
              thick_separator = "â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬"
              thin_separator = "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
              
              # Format caption
              caption = f"""{post_text}

{thick_separator}
<b>ğŸš€ QUICK ACTIONS ğŸš€</b>
{thick_separator}

<b>{'   â€¢   '.join(social_icons)}</b>

<b>{post_hashtags}</b>

â° <i>Posted: {datetime.now().strftime("%Y-%m-%d %H:%M UTC")}</i>
"""
              return caption
          
          def send_to_telegram():
              """Send message to Telegram with FULL WIDTH formatting"""
              # Get post
              post_num = os.getenv('POST_NUMBER', '0')
              post_text, post_hashtags = select_post(post_num)
              
              # Create caption
              caption = create_caption(post_text, post_hashtags)
              
              # Create buttons
              reply_markup = create_buttons()
              
              # Try to send with photo first
              url = f"https://api.telegram.org/bot{BOT_TOKEN}/sendPhoto"
              payload = {
                  "chat_id": CHAT_ID,
                  "photo": IMAGE_URL,
                  "caption": caption,
                  "parse_mode": "HTML",
                  "reply_markup": reply_markup
              }
              
              try:
                  response = requests.post(url, json=payload, timeout=30)
                  result = response.json()
                  
                  if result.get('ok'):
                      return True, result['result']['message_id']
                  else:
                      print(f"Photo error: {result}")
                      # Fallback to text
                      return send_text_fallback(caption, reply_markup)
                      
              except Exception as e:
                  print(f"Photo exception: {e}")
                  return send_text_fallback(caption, reply_markup)
          
          def send_text_fallback(caption, reply_markup):
              """Fallback to text message"""
              url = f"https://api.telegram.org/bot{BOT_TOKEN}/sendMessage"
              payload = {
                  "chat_id": CHAT_ID,
                  "text": caption,
                  "parse_mode": "HTML",
                  "reply_markup": reply_markup
              }
              
              try:
                  response = requests.post(url, json=payload, timeout=30)
                  result = response.json()
                  
                  if result.get('ok'):
                      return True, result['result']['message_id']
                  else:
                      print(f"Text error: {result}")
                      return False, None
                      
              except Exception as e:
                  print(f"Text exception: {e}")
                  return False, None
          
          def main():
              print("ğŸš€ CIBL Telegram Poster - FULL WIDTH VERSION")
              print("=" * 50)
              
              # Check config
              if not BOT_TOKEN:
                  print("âŒ BOT_TOKEN not set")
                  sys.exit(1)
              if not CHAT_ID:
                  print("âŒ CHAT_ID not set")
                  sys.exit(1)
              
              print(f"ğŸ“¢ Channel: {CHAT_ID}")
              print(f"ğŸ–¼ï¸ Image: {IMAGE_URL}")
              print(f"ğŸ“Š Post number: {os.getenv('POST_NUMBER', '0')}")
              
              # Send message
              print("\nğŸ“¤ Sending to Telegram...")
              success, message_id = send_to_telegram()
              
              if success:
                  print(f"\nâœ… SUCCESS!")
                  print(f"ğŸ“ Message ID: {message_id}")
                  print(f"ğŸ‰ Published to @CiBLofficial")
                  print(f"ğŸ”˜ Buttons: 3 full-width glass buttons")
                  print(f"ğŸ“ Format: Full width (no bot icon)")
                  return True
              else:
                  print("\nâŒ FAILED to send")
                  return False
          
          if __name__ == "__main__":
              success = main()
              sys.exit(0 if success else 1)
          EOF
          
          echo "âœ… Script created"

      - name: Run poster
        env:
          BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          CHAT_ID: ${{ secrets.TELEGRAM_CHANNEL_ID }}
          POST_NUMBER: ${{ github.event.inputs.post_number }}
        run: |
          python poster.py

      - name: Success
        if: success()
        run: |
          echo " "
          echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
          echo "â•‘      ğŸ‰ CIBL POST PUBLISHED!         â•‘"
          echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo " "
          echo "ğŸ“… Date: $(date)"
          echo "ğŸ“¢ Channel: @CiBLofficial"
          echo "ğŸ¤– Bot: @CIBtokenBot"
          echo "ğŸ“ Format: FULL WIDTH"
          echo "ğŸ–¼ï¸ Image: Yes (1200Ã—600)"
          echo "ğŸ”˜ Buttons: 3 glass buttons"
          echo "ğŸ‘¤ Bot icon: Hidden"
          echo " "