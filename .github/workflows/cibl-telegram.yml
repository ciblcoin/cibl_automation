name: CIBL Telegram Poster
on:
  workflow_dispatch:
    inputs:
      post_number:
        description: 'Post number (1-10) or 0 for random'
        required: true
        default: '0'
        type: string

jobs:
  publish:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Install dependencies
        run: |
          pip install requests

      - name: Create poster script
        run: |
          cat > poster.py << 'EOF'
          import os
          import sys
          import random
          import requests
          import json
          from datetime import datetime
          
          # Configuration
          BOT_TOKEN = os.getenv('BOT_TOKEN')
          CHAT_ID = os.getenv('CHAT_ID')
          
          # Image URL
          IMAGE_URL = "https://raw.githubusercontent.com/ciblcoin/app/main/public/videos/image1.png"
          
          # Posts Database - 10 English posts
          posts = [
              '''ğŸš€ CIBL MEGA AIRDROP - LIVE NOW! ğŸš€
          
          ğŸ”¥ The Biggest Airdrop Event on Solana Network!
          
          ğŸ“ Contract Address:
          2Lpgt5teMe4SPp1G8x1URBk6dPRoimftdANmAsFDvkPA
          
          ğŸ¯ WHY CIBL TOKEN?
          âœ… Massive Airdrop Rewards - Earn free tokens
          âœ… Strong Community - 5,000+ holders & growing
          âœ… Solana Network - Lightning fast, ultra low fees
          âœ… Transparent Team - Fully doxxed & committed
          âœ… Innovative Tokenomics - Sustainable growth model
          âœ… Huge Potential - Early stage gem with massive upside
          
          ğŸ”¥ LIMITED TIME OPPORTUNITY!
          Early participants receive exclusive bonus rewards!
          
          â° DON'T WAIT - JOIN THE REVOLUTION NOW!''',
              
              '''ğŸ“ˆ CIBL PRICE UPDATE â€“ TRENDING ON SOLANA! ğŸ“ˆ
          
          âš¡ Major Price Movement Detected â€“ Don't Miss Out!
          
          ğŸ“ Contract Address:
          2Lpgt5teMe4SPp1G8x1URBk6dPRoimftdANmAsFDvkPA
          
          ğŸš€ WHY CIBL IS MOVING?
          ğŸ“Š Strong fundamentals and growing adoption
          ğŸš€ Increasing trading volume and liquidity
          ğŸ‘¥ Rapid community expansion
          ğŸ¯ Strategic partnerships in development
          ğŸ”¥ Positive market sentiment and momentum
          
          ğŸ’ INVESTMENT OPPORTUNITY:
          â€¢ Early stage project with massive potential
          â€¢ Limited token supply available
          â€¢ Growing ecosystem integration
          â€¢ Upcoming exchange listings
          â€¢ Marketing campaigns underway''',
              
              '''ğŸ‘¥ JOIN 5,000+ CIBL HOLDERS COMMUNITY! ğŸ‘¥
          
          ğŸ’ª Strongest & Fastest Growing Community on Solana!
          
          ğŸ“ CONTRACT ADDRESS:
          2Lpgt5teMe4SPp1G8x1URBk6dPRoimftdANmAsFDvkPA
          
          ğŸ¤ COMMUNITY BENEFITS:
          âœ… Active discussions 24/7
          âœ… Regular AMA sessions with team
          âœ… Exclusive community events
          âœ… Early access to announcements
          âœ… Voting rights on decisions
          âœ… Supportive environment
          
          ğŸŒŸ WHY OUR COMMUNITY STANDS OUT:
          âœ¨ Genuine engagement and real conversations
          âœ¨ Helpful members always ready to assist
          âœ¨ Educational content for all levels
          âœ¨ Positive and encouraging atmosphere
          âœ¨ Strong sense of unity and common goals
          
          ğŸš€ JOIN THE MOVEMENT TODAY!''',
              
              '''ğŸ“¢ IMPORTANT CIBL ANNOUNCEMENT ğŸ“¢
          
          ğŸŒŸ Major Update for All CIBL Community Members!
          
          ğŸ“ CONTRACT ADDRESS:
          2Lpgt5teMe4SPp1G8x1URBk6dPRoimftdANmAsFDvkPA
          
          ğŸ¯ ANNOUNCEMENT DETAILS:
          âœ… New strategic partnerships secured
          âœ… Roadmap updates and future developments
          âœ… Enhanced token utility and features
          âœ… Expanded team with industry experts
          âœ… Improved website and documentation
          âœ… Upcoming marketing initiatives
          
          ğŸš€ WHAT THIS MEANS FOR YOU:
          âœ¨ Increased token value and utility
          âœ¨ Greater exposure and recognition
          âœ¨ More opportunities for rewards
          âœ¨ Enhanced platform features
          âœ¨ Stronger market position
          âœ¨ Better user experience
          
          â° STAY TUNED FOR MORE UPDATES!''',
              
              '''âœ¨ FROM STRUGGLE TO SUCCESS âœ¨
          
          Our friends made an incredible journey - now it's your turn!
          
          ğŸ™ï¸ Their city is full of animal friends, but cats are always first in line!
          
          ğŸ’ Time to fall in love with TON. Stay tuned, engage, and get rewarded!
          
          ğŸ¯ Quick Action Buttons Below â¬‡ï¸''',
              
              '''ğŸš€ CIBL IS TRENDING! ğŸš€
          
          Massive movements detected
          Join the revolution now!
          
          âš¡ Quick Actions Below â¬‡ï¸''',
              
              '''âš¡ URGENT: LIMITED TIME OFFER! âš¡
          
          CIBL Airdrop closing soon!
          Last chance to claim bonus rewards!
          
          ğŸ“ Contract Address:
          2Lpgt5teMe4SPp1G8x1URBk6dPRoimftdANmAsFDvkPA
          
          ğŸ¯ DON'T MISS OUT:
          âœ… Exclusive bonus for early participants
          âœ… Limited token distribution
          âœ… Growing community benefits
          âœ… Potential for massive returns
          
          â° ACT BEFORE IT'S TOO LATE!''',
              
              '''ğŸŒ CIBL ECOSYSTEM EXPANSION ğŸŒ
          
          Growing beyond expectations!
          New integrations and partnerships live.
          
          ğŸ“ CONTRACT ADDRESS:
          2Lpgt5teMe4SPp1G8x1URBk6dPRoimftdANmAsFDvkPA
          
          ğŸŒŸ NEW ADDITIONS:
          âœ… Enhanced swap functionality
          âœ… Additional wallet integrations
          âœ… Expanded token utilities
          âœ… New partnership announcements
          âœ… Community feature upgrades
          âœ… Marketing campaign expansion
          
          ğŸš€ BE PART OF OUR GROWTH STORY!''',
              
              '''ğŸŒ CONNECT WITH CIBL ACROSS ALL PLATFORMS! ğŸŒ
          
          âœ¨ Join Our Growing Social Media Network! âœ¨
          
          ğŸ“ Contract Address:
          2Lpgt5teMe4SPp1G8x1URBk6dPRoimftdANmAsFDvkPA
          
          ğŸ“± FOLLOW US EVERYWHERE:
          ğŸ¦ Twitter (X): Latest announcements
          ğŸ’¬ Telegram: 24/7 community discussions
          ğŸ“¸ Instagram: Visual content & highlights
          ğŸ® Discord: Advanced discussions
          ğŸ“º YouTube: Tutorials & educational content
          
          ğŸ”— STAY UPDATED WITH EVERY DEVELOPMENT!''',
              
              '''â° FINAL 24 HOURS! â°
          
          CIBL Mega Airdrop closing soon!
          Last opportunity for bonus rewards!
          
          ğŸ”¥ WHAT YOU GET:
          âœ… Free CIBL tokens
          âœ… Exclusive bonus rewards
          âœ… Early adopter benefits
          âœ… Community membership
          âœ… Future airdrop eligibility
          âœ… Voting rights
          
          ğŸ“ Contract Address:
          2Lpgt5teMe4SPp1G8x1URBk6dPRoimftdANmAsFDvkPA
          
          ğŸ’ DON'T REGRET MISSING OUT!'''
          ]
          
          # Hashtags for each post
          hashtags = [
              "#CIBL #Solana #Airdrop #Crypto #DeFi #Memecoin",
              "#CIBL #Solana #Crypto #Trading #Investing #Web3",
              "#CIBL #Solana #Community #Crypto #Blockchain",
              "#CIBL #Solana #Announcement #Update #DeFi",
              "#Transformation #Crypto #TON #Success #CIBL",
              "#CIBL #Solana #Crypto #Trending",
              "#CIBL #Airdrop #Urgent #LimitedTime #Crypto",
              "#CIBL #Ecosystem #Growth #Solana #Web3",
              "#CIBL #Solana #SocialMedia #Community #Network",
              "#CIBL #FinalHours #Airdrop #LastChance #Crypto"
          ]
          
          def select_post(post_num):
              try:
                  if post_num.isdigit():
                      num = int(post_num)
                      if 1 <= num <= len(posts):
                          return posts[num - 1], hashtags[num - 1]
                  return random.choice(posts), random.choice(hashtags)
              except:
                  return random.choice(posts), random.choice(hashtags)
          
          def create_full_width_buttons():
              """Create REAL glass buttons with inline keyboard"""
              return {
                  "inline_keyboard": [
                      [{"text": "ğŸŒ WEBSITE", "url": "https://ciblcoin.com"}],
                      [{"text": "ğŸª‚ AIRDROP", "url": "https://cbl.ag"}],
                      [{"text": "ğŸ”„ SWAP TOKEN", "url": "https://phantom.com/tokens/solana/2Lpgt5teMe4SPp1G8x1URBk6dPRoimftdANmAsFDvkPA?referralId=2325rur2wft"}]
                  ]
              }
          
          def send_telegram_message_with_photo(caption):
              """Send photo with caption and buttons"""
              url = f"https://api.telegram.org/bot{BOT_TOKEN}/sendPhoto"
              
              payload = {
                  "chat_id": CHAT_ID,
                  "photo": IMAGE_URL,
                  "caption": caption,
                  "parse_mode": "HTML",
                  "reply_markup": create_full_width_buttons()
              }
              
              try:
                  response = requests.post(url, json=payload, timeout=30)
                  return response.json()
              except Exception as e:
                  print(f"Photo send error: {e}")
                  # Fallback to text
                  return send_telegram_message_text(caption)
          
          def send_telegram_message_text(text):
              """Send text message with buttons (fallback)"""
              url = f"https://api.telegram.org/bot{BOT_TOKEN}/sendMessage"
              
              payload = {
                  "chat_id": CHAT_ID,
                  "text": text,
                  "parse_mode": "HTML",
                  "reply_markup": create_full_width_buttons()
              }
              
              try:
                  response = requests.post(url, json=payload, timeout=30)
                  return response.json()
              except Exception as e:
                  print(f"Text send error: {e}")
                  return None
          
          def format_full_width_message(post_text, post_hashtags):
              """Format message with full-width elements"""
              # Random social icons
              social_icons = ["ğŸ®", "ğ•", "ğŸ“±", "ğŸ’»", "ğŸ¦", "ğŸª", "ğŸ‘¾", "ğŸ•¹ï¸"]
              selected_icons = random.sample(social_icons, 4)
              
              # Create full-width separator
              separator = "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
              
              # Format message
              message = f"""<b>{post_text}</b>

          {separator}
          <b>ğŸš€ QUICK ACTIONS ğŸš€</b>
          {separator}

          <b>{'  |  '.join(selected_icons)}</b>

          <b>{post_hashtags}</b>

          â° Posted: {datetime.now().strftime("%Y-%m-%d %H:%M UTC")}
          """
              
              return message
          
          def main():
              print("ğŸš€ Starting CIBL Telegram Poster")
              
              if not BOT_TOKEN or not CHAT_ID:
                  print("âŒ Missing credentials")
                  sys.exit(1)
              
              post_num = os.getenv('POST_NUMBER', '0')
              print(f"ğŸ“Š Post number: {post_num}")
              print(f"ğŸ“¢ Channel ID: {CHAT_ID}")
              print(f"ğŸ–¼ï¸ Image: {IMAGE_URL}")
              
              # Select post
              post_text, post_hashtags = select_post(post_num)
              
              # Format message
              caption = format_full_width_message(post_text, post_hashtags)
              
              # Preview
              print("\nğŸ“‹ Preview:")
              print("-" * 50)
              print(caption[:200].replace('<b>', '').replace('</b>', '') + "...")
              print("-" * 50)
              
              # Send with photo
              print("\nğŸ“¤ Sending to Telegram...")
              result = send_telegram_message_with_photo(caption)
              
              if result and result.get('ok'):
                  print(f"âœ… Success! Message ID: {result['result']['message_id']}")
                  print(f"ğŸ‰ Published to @CiBLofficial")
                  print(f"ğŸ–¼ï¸ Image sent: Yes")
                  print(f"ğŸ”˜ Buttons: 3 glass buttons")
                  return True
              else:
                  print(f"âŒ Failed: {result}")
                  return False
          
          if __name__ == "__main__":
              success = main()
              sys.exit(0 if success else 1)
          EOF
          
          echo "âœ… Script created"

      - name: Run poster
        env:
          BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          CHAT_ID: ${{ secrets.TELEGRAM_CHANNEL_ID }}
          POST_NUMBER: ${{ github.event.inputs.post_number }}
        run: |
          python poster.py

      - name: Success message
        if: success()
        run: |
          echo "ğŸ‰ CIBL post published successfully!"
          echo "ğŸ“… $(date)"
          echo "ğŸ“¢ Channel: @CiBLofficial"
          echo "ğŸ¤– Bot: @CIBtokenBot"
          echo "ğŸ–¼ï¸ Image: GitHub hosted"
          echo "ğŸ”˜ Buttons: 3 full-width glass buttons"

      - name: Error message
        if: failure()
        run: |
          echo "âŒ Failed to publish"
          echo "ğŸ” Check logs above"
          echo "âœ… Checklist:"
          echo "1. BOT_TOKEN set in Secrets"
          echo "2. CHAT_ID set in Secrets (with -100)"
          echo "3. Bot is admin in channel"
          echo "4. Image URL is accessible"